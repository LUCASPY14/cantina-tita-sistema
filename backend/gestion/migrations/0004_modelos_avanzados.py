# Generated by Django 5.2.8 on 2026-02-11 00:38

import django.db.models.deletion
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('gestion', '0003_rename_productos_descrip_8ec57a_idx_productos_descrip_1ceb41_idx_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='AlertaAutomatica',
            fields=[
                ('id_alerta', models.AutoField(db_column='id_alerta', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('condicion', models.TextField(db_column='condicion')),
                ('tipo_alerta', models.CharField(choices=[('STOCK_BAJO', 'Stock Bajo'), ('VENTA_ALTA', 'Venta Alta'), ('ERROR_SISTEMA', 'Error Sistema'), ('KPI_META', 'Meta KPI'), ('PERSONALIZADA', 'Personalizada')], db_column='tipo_alerta', max_length=20)),
                ('nivel_criticidad', models.CharField(choices=[('BAJA', 'Baja'), ('MEDIA', 'Media'), ('ALTA', 'Alta'), ('CRITICA', 'Crítica')], db_column='criticidad', max_length=10)),
                ('frecuencia_verificacion', models.IntegerField(db_column='frecuencia_min', help_text='Minutos entre verificaciones')),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('ultima_verificacion', models.DateTimeField(blank=True, db_column='ultima_verificacion', null=True)),
            ],
            options={
                'verbose_name': 'Alerta Automática',
                'verbose_name_plural': 'Alertas Automáticas',
                'db_table': 'alertas_automaticas',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='CacheConfiguracion',
            fields=[
                ('id_cache', models.AutoField(db_column='id_cache', primary_key=True, serialize=False)),
                ('clave', models.CharField(db_column='clave', max_length=100, unique=True)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('ttl_segundos', models.IntegerField(db_column='ttl_segundos', default=300)),
                ('max_size_mb', models.IntegerField(db_column='max_size_mb', default=10)),
                ('tipo_cache', models.CharField(choices=[('MEMORIA', 'Memoria'), ('REDIS', 'Redis'), ('DATABASE', 'Base de datos'), ('FILE', 'Archivo')], db_column='tipo_cache', max_length=20)),
                ('invalidacion_automatica', models.BooleanField(db_column='auto_invalidate', default=True)),
                ('eventos_invalidacion', models.JSONField(db_column='eventos_invalid', default=list, help_text='Eventos que invalidan este cache')),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('hits', models.BigIntegerField(db_column='hits', default=0)),
                ('misses', models.BigIntegerField(db_column='misses', default=0)),
                ('ultima_limpieza', models.DateTimeField(blank=True, db_column='ultima_limpieza', null=True)),
            ],
            options={
                'verbose_name': 'Configuración de Cache',
                'verbose_name_plural': 'Configuraciones de Cache',
                'db_table': 'cache_configuracion',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='KpiMetrica',
            fields=[
                ('id_kpi', models.AutoField(db_column='id_kpi', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('formula', models.TextField(db_column='formula')),
                ('unidad_medida', models.CharField(db_column='unidad', max_length=20)),
                ('valor_objetivo', models.DecimalField(blank=True, db_column='valor_objetivo', decimal_places=2, max_digits=15, null=True)),
                ('categoria', models.CharField(choices=[('VENTAS', 'Ventas'), ('RENTABILIDAD', 'Rentabilidad'), ('CLIENTES', 'Clientes'), ('OPERACIONES', 'Operaciones'), ('CALIDAD', 'Calidad')], db_column='categoria', max_length=30)),
                ('frecuencia_calculo', models.CharField(choices=[('TIEMPO_REAL', 'Tiempo Real'), ('DIARIO', 'Diario'), ('SEMANAL', 'Semanal'), ('MENSUAL', 'Mensual')], db_column='frecuencia', max_length=20)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
            ],
            options={
                'verbose_name': 'KPI Métrica',
                'verbose_name_plural': 'KPI Métricas',
                'db_table': 'kpi_metricas',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='ProveedorApi',
            fields=[
                ('id_proveedor', models.AutoField(db_column='id_proveedor', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('tipo_servicio', models.CharField(choices=[('PAGOS', 'Procesador de Pagos'), ('SMS', 'Servicio SMS'), ('EMAIL', 'Servicio Email'), ('FACTURACION', 'Facturación Electrónica'), ('LOGISTICA', 'Logística'), ('ANALYTICS', 'Analytics'), ('OTRO', 'Otro')], db_column='tipo_servicio', max_length=30)),
                ('url_base', models.URLField(db_column='url_base')),
                ('version_api', models.CharField(blank=True, db_column='version', max_length=20)),
                ('documentacion_url', models.URLField(blank=True, db_column='documentacion', null=True)),
                ('tipo_autenticacion', models.CharField(choices=[('API_KEY', 'API Key'), ('OAUTH', 'OAuth'), ('BEARER', 'Bearer Token'), ('BASIC', 'Basic Auth'), ('CUSTOM', 'Custom')], db_column='tipo_auth', max_length=20)),
                ('config_autenticacion', models.JSONField(db_column='config_auth', default=dict, help_text='Configuración específica de autenticación (sin credenciales sensibles)')),
                ('timeout_segundos', models.IntegerField(db_column='timeout', default=30)),
                ('max_reintentos', models.IntegerField(db_column='max_reintentos', default=3)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
            ],
            options={
                'verbose_name': 'Proveedor de API',
                'verbose_name_plural': 'Proveedores de API',
                'db_table': 'proveedores_api',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='SmsTemplate',
            fields=[
                ('id_template', models.AutoField(db_column='id_template', primary_key=True, serialize=False)),
                ('codigo', models.CharField(db_column='codigo', max_length=50, unique=True)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('mensaje', models.CharField(db_column='mensaje', max_length=160)),
                ('variables_disponibles', models.JSONField(db_column='variables', default=list)),
                ('categoria', models.CharField(choices=[('CONFIRMACION', 'Confirmación'), ('ALERTA', 'Alerta'), ('PROMOCION', 'Promoción'), ('RECORDATORIO', 'Recordatorio')], db_column='categoria', max_length=30)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
            ],
            options={
                'verbose_name': 'Plantilla de SMS',
                'verbose_name_plural': 'Plantillas de SMS',
                'db_table': 'sms_templates',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='AlertaDestinatario',
            fields=[
                ('id_destinatario', models.AutoField(db_column='id_destinatario', primary_key=True, serialize=False)),
                ('via_email', models.BooleanField(db_column='via_email', default=True)),
                ('via_sistema', models.BooleanField(db_column='via_sistema', default=True)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('alerta', models.ForeignKey(db_column='id_alerta', on_delete=django.db.models.deletion.CASCADE, to='gestion.alertaautomatica')),
                ('empleado', models.ForeignKey(db_column='id_empleado', on_delete=django.db.models.deletion.CASCADE, to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Destinatario de Alerta',
                'verbose_name_plural': 'Destinatarios de Alertas',
                'db_table': 'alerta_destinatarios',
                'abstract': False,
                'managed': True,
                'unique_together': {('alerta', 'empleado')},
            },
        ),
        migrations.AddField(
            model_name='alertaautomatica',
            name='destinatarios',
            field=models.ManyToManyField(related_name='alertas_suscritas', through='gestion.AlertaDestinatario', to='gestion.empleado'),
        ),
        migrations.CreateModel(
            name='Dashboard',
            fields=[
                ('id_dashboard', models.AutoField(db_column='id_dashboard', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(blank=True, db_column='descripcion', null=True)),
                ('configuracion_json', models.JSONField(db_column='configuracion', default=dict)),
                ('es_publico', models.BooleanField(db_column='es_publico', default=False)),
                ('predeterminado', models.BooleanField(db_column='predeterminado', default=False)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_column='updated_at')),
                ('empleado', models.ForeignKey(db_column='id_empleado', on_delete=django.db.models.deletion.CASCADE, related_name='dashboards', to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Dashboard',
                'verbose_name_plural': 'Dashboards',
                'db_table': 'dashboards',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='DestinatarioTarea',
            fields=[
                ('id_destinatario', models.AutoField(db_column='id_destinatario', primary_key=True, serialize=False)),
                ('notificar_inicio', models.BooleanField(db_column='notif_inicio', default=False)),
                ('notificar_fin', models.BooleanField(db_column='notif_fin', default=True)),
                ('notificar_error', models.BooleanField(db_column='notif_error', default=True)),
                ('empleado', models.ForeignKey(db_column='id_empleado', on_delete=django.db.models.deletion.CASCADE, to='gestion.empleado')),
            ],
            options={
                'db_table': 'destinatarios_tarea',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='EmailTemplate',
            fields=[
                ('id_template', models.AutoField(db_column='id_template', primary_key=True, serialize=False)),
                ('codigo', models.CharField(db_column='codigo', max_length=50, unique=True)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(blank=True, db_column='descripcion', null=True)),
                ('asunto', models.CharField(db_column='asunto', max_length=200)),
                ('cuerpo_html', models.TextField(db_column='cuerpo_html')),
                ('cuerpo_texto', models.TextField(blank=True, db_column='cuerpo_texto', null=True)),
                ('variables_disponibles', models.JSONField(db_column='variables', default=list, help_text='Lista de variables que se pueden usar: {{cliente.nombre}}, {{fecha}}, etc.')),
                ('categoria', models.CharField(choices=[('BIENVENIDA', 'Bienvenida'), ('NOTIFICACION', 'Notificación'), ('PROMOCION', 'Promoción'), ('FACTURACION', 'Facturación'), ('RECORDATORIO', 'Recordatorio'), ('SISTEMA', 'Sistema')], db_column='categoria', max_length=30)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_column='updated_at')),
                ('created_by', models.ForeignKey(blank=True, db_column='created_by', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Plantilla de Email',
                'verbose_name_plural': 'Plantillas de Email',
                'db_table': 'email_templates',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='EmailEnviado',
            fields=[
                ('id_email', models.AutoField(db_column='id_email', primary_key=True, serialize=False)),
                ('email_destinatario', models.EmailField(db_column='email_destinatario', max_length=254)),
                ('nombre_destinatario', models.CharField(blank=True, db_column='nombre_destinatario', max_length=100)),
                ('asunto_enviado', models.CharField(db_column='asunto', max_length=200)),
                ('cuerpo_enviado', models.TextField(db_column='cuerpo')),
                ('estado', models.CharField(choices=[('PENDIENTE', 'Pendiente'), ('ENVIADO', 'Enviado'), ('ENTREGADO', 'Entregado'), ('REBOTADO', 'Rebotado'), ('ERROR', 'Error')], db_column='estado', default='PENDIENTE', max_length=20)),
                ('fecha_envio', models.DateTimeField(auto_now_add=True, db_column='fecha_envio')),
                ('fecha_entrega', models.DateTimeField(blank=True, db_column='fecha_entrega', null=True)),
                ('fecha_apertura', models.DateTimeField(blank=True, db_column='fecha_apertura', null=True)),
                ('mensaje_error', models.TextField(blank=True, db_column='mensaje_error', null=True)),
                ('intentos_envio', models.IntegerField(db_column='intentos', default=1)),
                ('cliente', models.ForeignKey(blank=True, db_column='id_cliente', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='emails_recibidos', to='gestion.cliente')),
                ('enviado_por', models.ForeignKey(blank=True, db_column='enviado_por', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
                ('template', models.ForeignKey(blank=True, db_column='id_template', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='emails_enviados', to='gestion.emailtemplate')),
            ],
            options={
                'verbose_name': 'Email Enviado',
                'verbose_name_plural': 'Emails Enviados',
                'db_table': 'emails_enviados',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='HistorialAlerta',
            fields=[
                ('id_historial', models.AutoField(db_column='id_historial', primary_key=True, serialize=False)),
                ('fecha_disparada', models.DateTimeField(auto_now_add=True, db_column='fecha_disparada')),
                ('mensaje', models.TextField(db_column='mensaje')),
                ('datos_contexto', models.JSONField(db_column='datos_contexto', default=dict)),
                ('resuelto', models.BooleanField(db_column='resuelto', default=False)),
                ('fecha_resolucion', models.DateTimeField(blank=True, db_column='fecha_resolucion', null=True)),
                ('alerta', models.ForeignKey(db_column='id_alerta', on_delete=django.db.models.deletion.CASCADE, related_name='historial', to='gestion.alertaautomatica')),
                ('resuelto_por', models.ForeignKey(blank=True, db_column='resuelto_por', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Historial de Alerta',
                'verbose_name_plural': 'Historial de Alertas',
                'db_table': 'historial_alertas',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='PerfilUsuario',
            fields=[
                ('id_perfil', models.AutoField(db_column='id_perfil', primary_key=True, serialize=False)),
                ('tema_ui', models.CharField(choices=[('CLARO', 'Tema Claro'), ('OSCURO', 'Tema Oscuro'), ('AUTO', 'Automático')], db_column='tema', default='CLARO', max_length=20)),
                ('idioma', models.CharField(choices=[('ES', 'Español'), ('EN', 'English'), ('PT', 'Português')], db_column='idioma', default='ES', max_length=10)),
                ('zona_horaria', models.CharField(db_column='timezone', default='America/Asuncion', max_length=50)),
                ('dashboard_config', models.JSONField(db_column='dashboard_config', default=dict, help_text='Configuración de widgets y layout del dashboard')),
                ('menu_colapsado', models.BooleanField(db_column='menu_colapsado', default=False)),
                ('notif_email_activo', models.BooleanField(db_column='notif_email', default=True)),
                ('notif_push_activo', models.BooleanField(db_column='notif_push', default=True)),
                ('notif_desktop_activo', models.BooleanField(db_column='notif_desktop', default=False)),
                ('formato_fecha_preferido', models.CharField(choices=[('DD/MM/YYYY', 'DD/MM/YYYY'), ('MM/DD/YYYY', 'MM/DD/YYYY'), ('YYYY-MM-DD', 'YYYY-MM-DD')], db_column='formato_fecha', default='DD/MM/YYYY', max_length=20)),
                ('moneda_preferida', models.CharField(choices=[('PYG', 'Guaraníes (Gs.)'), ('USD', 'Dólares ($)'), ('EUR', 'Euros (€)')], db_column='moneda', default='PYG', max_length=10)),
                ('configuraciones_adicionales', models.JSONField(blank=True, db_column='config_adicional', default=dict)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
                ('updated_at', models.DateTimeField(auto_now=True, db_column='updated_at')),
                ('empleado', models.OneToOneField(db_column='id_empleado', on_delete=django.db.models.deletion.CASCADE, related_name='perfil', to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Perfil de Usuario',
                'verbose_name_plural': 'Perfiles de Usuario',
                'db_table': 'perfiles_usuario',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='PlantillaTarea',
            fields=[
                ('id_plantilla', models.AutoField(db_column='id_plantilla', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('tipo_tarea', models.CharField(choices=[('BACKUP', 'Backup de datos'), ('REPORTE', 'Generación de reportes'), ('LIMPIEZA', 'Limpieza de datos'), ('NOTIFICACION', 'Envío de notificaciones'), ('IMPORTACION', 'Importación de datos'), ('EXPORTACION', 'Exportación de datos'), ('MANTENIMIENTO', 'Mantenimiento del sistema')], db_column='tipo_tarea', max_length=30)),
                ('comando_ejecutar', models.TextField(db_column='comando')),
                ('parametros', models.JSONField(db_column='parametros', default=dict)),
                ('frecuencia', models.CharField(choices=[('MANUAL', 'Manual'), ('MINUTELY', 'Cada minuto'), ('HOURLY', 'Cada hora'), ('DAILY', 'Diario'), ('WEEKLY', 'Semanal'), ('MONTHLY', 'Mensual'), ('CRON', 'Expresión Cron')], db_column='frecuencia', max_length=20)),
                ('cron_expresion', models.CharField(blank=True, db_column='cron', help_text='Para frecuencia tipo CRON', max_length=100)),
                ('timeout_segundos', models.IntegerField(db_column='timeout', default=300)),
                ('max_reintentos', models.IntegerField(db_column='max_reintentos', default=3)),
                ('notificar_exito', models.BooleanField(db_column='notif_exito', default=False)),
                ('notificar_error', models.BooleanField(db_column='notif_error', default=True)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
                ('created_by', models.ForeignKey(blank=True, db_column='created_by', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
                ('destinatarios_notif', models.ManyToManyField(related_name='tareas_suscritas', through='gestion.DestinatarioTarea', to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Plantilla de Tarea',
                'verbose_name_plural': 'Plantillas de Tareas',
                'db_table': 'plantillas_tarea',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.AddField(
            model_name='destinatariotarea',
            name='plantilla',
            field=models.ForeignKey(db_column='id_plantilla', on_delete=django.db.models.deletion.CASCADE, to='gestion.plantillatarea'),
        ),
        migrations.CreateModel(
            name='EndpointApi',
            fields=[
                ('id_endpoint', models.AutoField(db_column='id_endpoint', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('path', models.CharField(db_column='path', max_length=200)),
                ('metodo_http', models.CharField(choices=[('GET', 'GET'), ('POST', 'POST'), ('PUT', 'PUT'), ('DELETE', 'DELETE'), ('PATCH', 'PATCH')], db_column='metodo', max_length=10)),
                ('headers_requeridos', models.JSONField(db_column='headers', default=dict)),
                ('parametros_requeridos', models.JSONField(db_column='parametros', default=dict)),
                ('schema_request', models.JSONField(db_column='schema_request', default=dict)),
                ('schema_response', models.JSONField(db_column='schema_response', default=dict)),
                ('cache_duracion', models.IntegerField(db_column='cache_segundos', default=0, help_text='0 = sin cache')),
                ('requiere_auth', models.BooleanField(db_column='requiere_auth', default=True)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('proveedor', models.ForeignKey(db_column='id_proveedor', on_delete=django.db.models.deletion.CASCADE, related_name='endpoints', to='gestion.proveedorapi')),
            ],
            options={
                'verbose_name': 'Endpoint de API',
                'verbose_name_plural': 'Endpoints de API',
                'db_table': 'endpoints_api',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='ReporteTemplate',
            fields=[
                ('id_template', models.AutoField(db_column='id_template', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(blank=True, db_column='descripcion', null=True)),
                ('query_sql', models.TextField(db_column='query_sql')),
                ('parametros_json', models.JSONField(blank=True, db_column='parametros', default=dict)),
                ('tipo_reporte', models.CharField(choices=[('VENTAS', 'Ventas'), ('PRODUCTOS', 'Productos'), ('CLIENTES', 'Clientes'), ('FINANCIERO', 'Financiero'), ('OPERATIVO', 'Operativo')], db_column='tipo_reporte', max_length=20)),
                ('frecuencia_auto', models.CharField(choices=[('MANUAL', 'Manual'), ('DIARIO', 'Diario'), ('SEMANAL', 'Semanal'), ('MENSUAL', 'Mensual')], db_column='frecuencia', default='MANUAL', max_length=20)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
                ('created_by', models.ForeignKey(blank=True, db_column='created_by', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Plantilla de Reporte',
                'verbose_name_plural': 'Plantillas de Reportes',
                'db_table': 'reporte_templates',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='SmsEnviado',
            fields=[
                ('id_sms', models.AutoField(db_column='id_sms', primary_key=True, serialize=False)),
                ('telefono_destinatario', models.CharField(db_column='telefono', max_length=20)),
                ('mensaje_enviado', models.CharField(db_column='mensaje', max_length=160)),
                ('estado', models.CharField(choices=[('PENDIENTE', 'Pendiente'), ('ENVIADO', 'Enviado'), ('ENTREGADO', 'Entregado'), ('ERROR', 'Error')], db_column='estado', default='PENDIENTE', max_length=20)),
                ('fecha_envio', models.DateTimeField(auto_now_add=True, db_column='fecha_envio')),
                ('fecha_entrega', models.DateTimeField(blank=True, db_column='fecha_entrega', null=True)),
                ('costo', models.DecimalField(blank=True, db_column='costo', decimal_places=2, max_digits=10, null=True)),
                ('cliente', models.ForeignKey(blank=True, db_column='id_cliente', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.cliente')),
                ('enviado_por', models.ForeignKey(blank=True, db_column='enviado_por', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
                ('template', models.ForeignKey(blank=True, db_column='id_template', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.smstemplate')),
            ],
            options={
                'verbose_name': 'SMS Enviado',
                'verbose_name_plural': 'SMS Enviados',
                'db_table': 'sms_enviados',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='CampanaComunicacion',
            fields=[
                ('id_campana', models.AutoField(db_column='id_campana', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('tipo_comunicacion', models.CharField(choices=[('EMAIL', 'Email'), ('SMS', 'SMS'), ('PUSH', 'Push Notification'), ('COMBINADO', 'Combinado')], db_column='tipo', max_length=20)),
                ('segmentacion_sql', models.TextField(db_column='segmentacion', help_text='Query SQL para seleccionar destinatarios')),
                ('fecha_programada', models.DateTimeField(blank=True, db_column='fecha_programada', null=True)),
                ('fecha_enviada', models.DateTimeField(blank=True, db_column='fecha_enviada', null=True)),
                ('estado', models.CharField(choices=[('BORRADOR', 'Borrador'), ('PROGRAMADA', 'Programada'), ('ENVIANDO', 'Enviando'), ('COMPLETADA', 'Completada'), ('CANCELADA', 'Cancelada')], db_column='estado', default='BORRADOR', max_length=20)),
                ('total_destinatarios', models.IntegerField(db_column='total_destinatarios', default=0)),
                ('total_enviados', models.IntegerField(db_column='total_enviados', default=0)),
                ('total_entregados', models.IntegerField(db_column='total_entregados', default=0)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
                ('created_by', models.ForeignKey(blank=True, db_column='created_by', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
                ('email_template', models.ForeignKey(blank=True, db_column='id_email_template', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.emailtemplate')),
                ('sms_template', models.ForeignKey(blank=True, db_column='id_sms_template', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.smstemplate')),
            ],
            options={
                'verbose_name': 'Campaña de Comunicación',
                'verbose_name_plural': 'Campañas de Comunicación',
                'db_table': 'campanas_comunicacion',
                'abstract': False,
                'managed': True,
            },
        ),
        migrations.CreateModel(
            name='WebhookEndpoint',
            fields=[
                ('id_webhook', models.AutoField(db_column='id_webhook', primary_key=True, serialize=False)),
                ('nombre', models.CharField(db_column='nombre', max_length=100)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('path', models.CharField(db_column='path', max_length=200)),
                ('requiere_verificacion', models.BooleanField(db_column='requiere_verificacion', default=True)),
                ('secret_key', models.CharField(blank=True, db_column='secret_key', max_length=255)),
                ('verificacion_header', models.CharField(blank=True, db_column='header_verificacion', max_length=100)),
                ('eventos_aceptados', models.JSONField(db_column='eventos', default=list, help_text='Lista de eventos que acepta este webhook')),
                ('handler_function', models.CharField(db_column='handler_func', help_text='Función que procesa el webhook: app.module.function_name', max_length=200)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
                ('proveedor', models.ForeignKey(db_column='id_proveedor', on_delete=django.db.models.deletion.CASCADE, related_name='webhooks', to='gestion.proveedorapi')),
            ],
            options={
                'verbose_name': 'Webhook Endpoint',
                'verbose_name_plural': 'Webhook Endpoints',
                'db_table': 'webhook_endpoints',
                'abstract': False,
                'managed': True,
                'unique_together': {('proveedor', 'path')},
            },
        ),
        migrations.CreateModel(
            name='ConfiguracionSistema',
            fields=[
                ('id_config', models.AutoField(db_column='id_config', primary_key=True, serialize=False)),
                ('clave', models.CharField(db_column='clave', max_length=100, unique=True)),
                ('valor', models.TextField(db_column='valor')),
                ('tipo_dato', models.CharField(choices=[('STRING', 'Texto'), ('INTEGER', 'Número entero'), ('DECIMAL', 'Número decimal'), ('BOOLEAN', 'Verdadero/Falso'), ('JSON', 'JSON'), ('DATE', 'Fecha'), ('TIME', 'Hora'), ('DATETIME', 'Fecha y hora')], db_column='tipo', max_length=20)),
                ('categoria', models.CharField(choices=[('GENERAL', 'General'), ('FACTURACION', 'Facturación'), ('NOTIFICACIONES', 'Notificaciones'), ('SEGURIDAD', 'Seguridad'), ('INTEGRACIONES', 'Integraciones'), ('UI', 'Interfaz de Usuario'), ('REPORTES', 'Reportes'), ('SISTEMA', 'Sistema')], db_column='categoria', max_length=50)),
                ('descripcion', models.TextField(db_column='descripcion')),
                ('valor_por_defecto', models.TextField(db_column='valor_defecto')),
                ('es_requerido', models.BooleanField(db_column='requerido', default=False)),
                ('validacion_regex', models.CharField(blank=True, db_column='validacion', max_length=500)),
                ('valores_permitidos', models.JSONField(blank=True, db_column='valores_permitidos', default=list, help_text='Lista de valores válidos (para select/choice)')),
                ('valor_minimo', models.CharField(blank=True, db_column='valor_min', max_length=100)),
                ('valor_maximo', models.CharField(blank=True, db_column='valor_max', max_length=100)),
                ('requiere_reinicio', models.BooleanField(db_column='requiere_reinicio', default=False)),
                ('solo_superuser', models.BooleanField(db_column='solo_superuser', default=False)),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('updated_at', models.DateTimeField(auto_now=True, db_column='updated_at')),
                ('updated_by', models.ForeignKey(blank=True, db_column='updated_by', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Configuración del Sistema',
                'verbose_name_plural': 'Configuraciones del Sistema',
                'db_table': 'configuracion_sistema',
                'abstract': False,
                'managed': True,
                'indexes': [models.Index(fields=['categoria'], name='configuraci_categor_1e5d8e_idx'), models.Index(fields=['clave'], name='configuraci_clave_2555cf_idx')],
            },
        ),
        migrations.CreateModel(
            name='LogLlamadaApi',
            fields=[
                ('id_log', models.AutoField(db_column='id_log', primary_key=True, serialize=False)),
                ('timestamp', models.DateTimeField(auto_now_add=True, db_column='timestamp')),
                ('metodo_http', models.CharField(db_column='metodo', max_length=10)),
                ('url_completa', models.URLField(db_column='url', max_length=500)),
                ('headers_request', models.JSONField(db_column='headers_req', default=dict)),
                ('payload_request', models.TextField(blank=True, db_column='payload_req', null=True)),
                ('status_code', models.IntegerField(db_column='status_code')),
                ('headers_response', models.JSONField(db_column='headers_res', default=dict)),
                ('payload_response', models.TextField(blank=True, db_column='payload_res', null=True)),
                ('tiempo_respuesta_ms', models.IntegerField(db_column='tiempo_ms')),
                ('bytes_enviados', models.IntegerField(blank=True, db_column='bytes_sent', null=True)),
                ('bytes_recibidos', models.IntegerField(blank=True, db_column='bytes_received', null=True)),
                ('exitoso', models.BooleanField(db_column='exitoso', default=True)),
                ('mensaje_error', models.TextField(blank=True, db_column='error_msg', null=True)),
                ('intento_numero', models.IntegerField(db_column='intento', default=1)),
                ('ip_origen', models.GenericIPAddressField(blank=True, db_column='ip_origen', null=True)),
                ('contexto_adicional', models.JSONField(db_column='contexto', default=dict)),
                ('endpoint', models.ForeignKey(blank=True, db_column='id_endpoint', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.endpointapi')),
                ('usuario_sistema', models.ForeignKey(blank=True, db_column='id_empleado', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
            ],
            options={
                'verbose_name': 'Log de Llamada API',
                'verbose_name_plural': 'Logs de Llamadas API',
                'db_table': 'log_llamadas_api',
                'abstract': False,
                'managed': True,
                'indexes': [models.Index(fields=['timestamp'], name='log_llamada_timesta_666163_idx'), models.Index(fields=['exitoso'], name='log_llamada_exitoso_ecef59_idx'), models.Index(fields=['endpoint', 'timestamp'], name='log_llamada_id_endp_923958_idx')],
            },
        ),
        migrations.CreateModel(
            name='EjecucionTarea',
            fields=[
                ('id_ejecucion', models.AutoField(db_column='id_ejecucion', primary_key=True, serialize=False)),
                ('fecha_inicio', models.DateTimeField(auto_now_add=True, db_column='fecha_inicio')),
                ('fecha_fin', models.DateTimeField(blank=True, db_column='fecha_fin', null=True)),
                ('duracion_segundos', models.IntegerField(blank=True, db_column='duracion_seg', null=True)),
                ('estado', models.CharField(choices=[('INICIADO', 'Iniciado'), ('EJECUTANDO', 'Ejecutando'), ('COMPLETADO', 'Completado'), ('ERROR', 'Error'), ('TIMEOUT', 'Timeout'), ('CANCELADO', 'Cancelado')], db_column='estado', max_length=20)),
                ('resultado', models.TextField(blank=True, db_column='resultado', null=True)),
                ('mensaje_error', models.TextField(blank=True, db_column='error_msg', null=True)),
                ('logs_ejecucion', models.TextField(blank=True, db_column='logs', null=True)),
                ('pid_proceso', models.IntegerField(blank=True, db_column='pid', null=True)),
                ('servidor', models.CharField(blank=True, db_column='servidor', max_length=100)),
                ('parametros_usados', models.JSONField(db_column='parametros', default=dict)),
                ('ejecutado_por', models.ForeignKey(blank=True, db_column='ejecutado_por', help_text='NULL si fue automático', null=True, on_delete=django.db.models.deletion.SET_NULL, to='gestion.empleado')),
                ('plantilla', models.ForeignKey(db_column='id_plantilla', on_delete=django.db.models.deletion.CASCADE, related_name='ejecuciones', to='gestion.plantillatarea')),
            ],
            options={
                'verbose_name': 'Ejecución de Tarea',
                'verbose_name_plural': 'Ejecuciones de Tareas',
                'db_table': 'ejecuciones_tarea',
                'abstract': False,
                'managed': True,
                'indexes': [models.Index(fields=['fecha_inicio'], name='ejecuciones_fecha_i_5e2112_idx'), models.Index(fields=['estado'], name='ejecuciones_estado_1c05ad_idx'), models.Index(fields=['plantilla', 'fecha_inicio'], name='ejecuciones_id_plan_5274a4_idx')],
            },
        ),
        migrations.AlterUniqueTogether(
            name='destinatariotarea',
            unique_together={('plantilla', 'empleado')},
        ),
        migrations.CreateModel(
            name='CredencialApi',
            fields=[
                ('id_credencial', models.AutoField(db_column='id_credencial', primary_key=True, serialize=False)),
                ('ambiente', models.CharField(choices=[('DESARROLLO', 'Desarrollo'), ('PRUEBAS', 'Pruebas'), ('PRODUCCION', 'Producción')], db_column='ambiente', max_length=20)),
                ('api_key_encrypted', models.TextField(blank=True, db_column='api_key', null=True)),
                ('secret_encrypted', models.TextField(blank=True, db_column='secret', null=True)),
                ('token_encrypted', models.TextField(blank=True, db_column='token', null=True)),
                ('configuracion_json', models.JSONField(db_column='configuracion', default=dict)),
                ('fecha_expiracion', models.DateTimeField(blank=True, db_column='fecha_expiracion', null=True)),
                ('ultima_actualizacion', models.DateTimeField(auto_now=True, db_column='updated_at')),
                ('activo', models.BooleanField(db_column='activo', default=True)),
                ('proveedor', models.ForeignKey(db_column='id_proveedor', on_delete=django.db.models.deletion.CASCADE, related_name='credenciales', to='gestion.proveedorapi')),
            ],
            options={
                'verbose_name': 'Credencial de API',
                'verbose_name_plural': 'Credenciales de API',
                'db_table': 'credenciales_api',
                'abstract': False,
                'managed': True,
                'unique_together': {('proveedor', 'ambiente')},
            },
        ),
        migrations.CreateModel(
            name='ValorKpi',
            fields=[
                ('id_valor', models.AutoField(db_column='id_valor', primary_key=True, serialize=False)),
                ('fecha', models.DateField(db_column='fecha')),
                ('valor', models.DecimalField(db_column='valor', decimal_places=2, max_digits=15)),
                ('notas', models.TextField(blank=True, db_column='notas', null=True)),
                ('calculado_automaticamente', models.BooleanField(db_column='auto_calc', default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_column='created_at')),
                ('kpi', models.ForeignKey(db_column='id_kpi', on_delete=django.db.models.deletion.CASCADE, related_name='valores', to='gestion.kpimetrica')),
            ],
            options={
                'verbose_name': 'Valor KPI',
                'verbose_name_plural': 'Valores KPI',
                'db_table': 'valores_kpi',
                'abstract': False,
                'managed': True,
                'unique_together': {('kpi', 'fecha')},
            },
        ),
        migrations.CreateModel(
            name='LogWebhook',
            fields=[
                ('id_log', models.AutoField(db_column='id_log', primary_key=True, serialize=False)),
                ('timestamp', models.DateTimeField(auto_now_add=True, db_column='timestamp')),
                ('headers_recibidos', models.JSONField(db_column='headers', default=dict)),
                ('payload_recibido', models.TextField(db_column='payload')),
                ('evento_tipo', models.CharField(blank=True, db_column='evento_tipo', max_length=100)),
                ('verificacion_exitosa', models.BooleanField(db_column='verificacion_ok', default=False)),
                ('procesado_exitosamente', models.BooleanField(db_column='procesado_ok', default=False)),
                ('tiempo_procesamiento_ms', models.IntegerField(blank=True, db_column='tiempo_proc_ms', null=True)),
                ('mensaje_error', models.TextField(blank=True, db_column='error_msg', null=True)),
                ('ip_origen', models.GenericIPAddressField(db_column='ip_origen')),
                ('user_agent', models.TextField(blank=True, db_column='user_agent', null=True)),
                ('webhook', models.ForeignKey(blank=True, db_column='id_webhook', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='logs', to='gestion.webhookendpoint')),
            ],
            options={
                'verbose_name': 'Log de Webhook',
                'verbose_name_plural': 'Logs de Webhooks',
                'db_table': 'log_webhooks',
                'abstract': False,
                'managed': True,
                'indexes': [models.Index(fields=['timestamp'], name='log_webhook_timesta_014966_idx'), models.Index(fields=['procesado_exitosamente'], name='log_webhook_procesa_5e04c3_idx'), models.Index(fields=['webhook', 'timestamp'], name='log_webhook_id_webh_40a819_idx')],
            },
        ),
    ]
