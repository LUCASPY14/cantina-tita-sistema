{% load paraguay_filters l10n %}
<!-- Grid de productos con HTMX -->
{% for producto in productos %}
<div 
    class="card bg-white shadow-lg hover:shadow-xl transition-shadow cursor-pointer producto-card"
    data-producto-id="{{ producto.id_producto }}"
    data-producto-name="{{ producto.descripcion|escapejs }}"
    data-producto-price="{{ producto.precio_actual|unlocalize }}"
    data-es-por-kilo="{{ producto.es_por_kilo|yesno:'true,false' }}"
    onclick="agregarProductoAlCarrito(this)"
>
    <div class="card-body p-4 text-center">
        <!-- Icono del producto -->
        <div class="text-4xl mb-2">
            {% if 'COCA' in producto.descripcion|upper or 'PEPSI' in producto.descripcion|upper %}
                ü•§
            {% elif 'GALLETA' in producto.descripcion|upper or 'PEPITO' in producto.descripcion|upper %}
                üç™
            {% elif 'CHIP' in producto.descripcion|upper %}
                üçø
            {% elif 'AGUA' in producto.descripcion|upper %}
                üíß
            {% elif 'JUGO' in producto.descripcion|upper %}
                üßÉ
            {% elif 'CHOCOLATE' in producto.descripcion|upper or 'TREBOL' in producto.descripcion|upper %}
                üç´
            {% elif 'S√ÅNDWICH' in producto.descripcion|upper or 'ALMUERZO' in producto.descripcion|upper or 'KILO' in producto.descripcion|upper %}
                üç±
            {% else %}
                üçΩÔ∏è
            {% endif %}
        </div>
        
        <!-- Nombre del producto -->
        <h3 class="font-bold text-sm mb-1 line-clamp-2" title="{{ producto.descripcion }}">
            {{ producto.descripcion }}
        </h3>
        
        <!-- C√≥digo de barra -->
        {% if producto.codigo_barra %}
        <p class="text-xs text-gray-500 mb-2">
            {{ producto.codigo_barra }}
        </p>
        {% endif %}
        
        <!-- Precio -->
        <div class="badge badge-primary badge-lg font-bold">
            {% if producto.es_por_kilo %}
                {{ producto.precio_actual|default:0|guaranies }}/kg
            {% else %}
                {{ producto.precio_actual|default:0|guaranies }}
            {% endif %}
        </div>
        
        <!-- Indicador de producto por kilo -->
        {% if producto.es_por_kilo %}
        <div class="badge badge-info badge-sm mt-2">
            ‚öñÔ∏è Por kilo
        </div>
        {% endif %}
        
        <!-- Stock indicator -->
        {% if producto.stock %}
            {% if producto.stock.stock_actual < 10 and producto.stock.stock_actual > 0 %}
                <div class="badge badge-warning badge-sm mt-2">
                    Stock: {{ producto.stock.stock_actual|floatformat:0 }}
                </div>
            {% elif producto.stock.stock_actual == 0 %}
                <div class="badge badge-error badge-sm mt-2">
                    Sin stock
                </div>
            {% endif %}
        {% endif %}
    </div>
</div>
{% empty %}
<div class="col-span-full text-center py-12 text-gray-400">
    <p class="text-4xl mb-2">üîç</p>
    <p>No se encontraron productos</p>
</div>
{% endfor %}
