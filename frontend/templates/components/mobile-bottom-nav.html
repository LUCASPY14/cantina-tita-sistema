{% comment %}
Bottom Navigation Component for Mobile
Incluir en templates que necesiten navegación móvil
Uso: {% include "components/mobile-bottom-nav.html" with active_page="dashboard" %}
{% endcomment %}

<nav class="bottom-nav md:hidden no-print" x-data="{ showNav: true, lastScroll: 0 }" 
     x-init="
        window.addEventListener('scroll', () => {
            let currentScroll = window.pageYOffset;
            if (currentScroll > lastScroll && currentScroll > 100) {
                showNav = false;
            } else {
                showNav = true;
            }
            lastScroll = currentScroll;
        });
     "
     x-show="showNav"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="transform translate-y-full"
     x-transition:enter-end="transform translate-y-0"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="transform translate-y-0"
     x-transition:leave-end="transform translate-y-full">
    
    {% if user.is_authenticated %}
        <!-- POS Navigation -->
        {% if 'pos' in request.resolver_match.namespace or not request.resolver_match.namespace %}
            <a href="{% url 'pos:dashboard' %}" 
               class="bottom-nav-item {% if active_page == 'dashboard' %}active{% endif %}">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </a>
            
            <a href="{% url 'pos:venta' %}" 
               class="bottom-nav-item {% if active_page == 'venta' %}active{% endif %}">
                <i class="fas fa-cash-register"></i>
                <span>Vender</span>
            </a>
            
            <a href="{% url 'pos:inventario_productos' %}" 
               class="bottom-nav-item {% if active_page == 'productos' %}active{% endif %}">
                <i class="fas fa-boxes"></i>
                <span>Productos</span>
            </a>
            
            <a href="{% url 'pos:reportes' %}" 
               class="bottom-nav-item {% if active_page == 'reportes' %}active{% endif %}">
                <i class="fas fa-chart-bar"></i>
                <span>Reportes</span>
            </a>
            
            <button @click="$refs.menuDrawer.checked = !$refs.menuDrawer.checked" 
                    class="bottom-nav-item">
                <i class="fas fa-bars"></i>
                <span>Menú</span>
            </button>
        
        <!-- Portal de Padres Navigation -->
        {% elif 'clientes' in request.resolver_match.namespace %}
            <a href="{% url 'clientes:portal_dashboard' %}" 
               class="bottom-nav-item {% if active_page == 'dashboard' %}active{% endif %}">
                <i class="fas fa-home"></i>
                <span>Inicio</span>
            </a>
            
            <a href="{% url 'clientes:recargar' %}" 
               class="bottom-nav-item {% if active_page == 'recargar' %}active{% endif %}">
                <i class="fas fa-credit-card"></i>
                <span>Recargar</span>
            </a>
            
            <a href="{% url 'clientes:historial' %}" 
               class="bottom-nav-item {% if active_page == 'historial' %}active{% endif %}">
                <i class="fas fa-history"></i>
                <span>Historial</span>
            </a>
            
            <a href="{% url 'clientes:perfil' %}" 
               class="bottom-nav-item {% if active_page == 'perfil' %}active{% endif %}">
                <i class="fas fa-user"></i>
                <span>Perfil</span>
            </a>
        
        <!-- Gestión/Admin Navigation -->
        {% elif 'gestion' in request.resolver_match.namespace %}
            <a href="{% url 'gestion:dashboard' %}" 
               class="bottom-nav-item {% if active_page == 'dashboard' %}active{% endif %}">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            
            <a href="{% url 'gestion:productos_lista' %}" 
               class="bottom-nav-item {% if active_page == 'productos' %}active{% endif %}">
                <i class="fas fa-box"></i>
                <span>Productos</span>
            </a>
            
            <a href="{% url 'gestion:clientes_lista' %}" 
               class="bottom-nav-item {% if active_page == 'clientes' %}active{% endif %}">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </a>
            
            <a href="{% url 'gestion:ventas_lista' %}" 
               class="bottom-nav-item {% if active_page == 'ventas' %}active{% endif %}">
                <i class="fas fa-receipt"></i>
                <span>Ventas</span>
            </a>
            
            <button @click="$refs.menuDrawer.checked = !$refs.menuDrawer.checked" 
                    class="bottom-nav-item">
                <i class="fas fa-ellipsis-h"></i>
                <span>Más</span>
            </button>
        {% endif %}
    {% endif %}
</nav>

<!-- Floating Action Button (opcional) -->
<div class="fab-mobile md:hidden no-print" x-data="{ open: false }">
    {% block fab_button %}
        <!-- Los templates hijos pueden sobrescribir esto -->
        {% if active_page == 'dashboard' %}
            <button @click="open = !open" 
                    class="btn btn-circle btn-lg bg-primary hover:bg-orange-600 text-white shadow-2xl"
                    :class="{ 'rotate-45': open }">
                <i class="fas fa-plus text-2xl" x-show="!open"></i>
                <i class="fas fa-times text-2xl" x-show="open"></i>
            </button>
            
            <!-- Menu de acciones rápidas -->
            <div x-show="open"
                 x-transition:enter="transition ease-out duration-200"
                 x-transition:enter-start="opacity-0 transform scale-0"
                 x-transition:enter-end="opacity-100 transform scale-100"
                 x-transition:leave="transition ease-in duration-150"
                 x-transition:leave-start="opacity-100 transform scale-100"
                 x-transition:leave-end="opacity-0 transform scale-0"
                 @click.away="open = false"
                 class="absolute bottom-20 right-0 flex flex-col gap-3">
                
                {% block fab_actions %}
                    <!-- Acciones específicas de cada página -->
                {% endblock %}
            </div>
        {% endif %}
    {% endblock %}
</div>

<style>
    /* Animación del FAB */
    .fab-mobile button {
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    .fab-mobile button.rotate-45 {
        transform: rotate(45deg);
    }
    
    /* Ajuste para evitar que el contenido quede detrás del bottom nav */
    @media (max-width: 768px) {
        body {
            padding-bottom: env(safe-area-inset-bottom, 0px);
        }
    }
</style>
