<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Integraci√≥n Frontend-Backend</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-8 text-center">üîó Integraci√≥n Frontend-Backend</h1>
        
        <!-- Estado de Conexi√≥n -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üìä Estado del Sistema</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-4 bg-green-100 rounded-lg">
                    <h3 class="font-semibold text-green-800">Frontend (Vite)</h3>
                    <p class="text-green-600">‚úÖ http://localhost:3000</p>
                    <p class="text-sm text-gray-600">TypeScript + Alpine.js + HTMX + Tailwind</p>
                </div>
                <div class="p-4 bg-blue-100 rounded-lg" id="backend-status">
                    <h3 class="font-semibold text-blue-800">Backend (Django)</h3>
                    <p class="text-blue-600" id="backend-url">üîÑ Conectando...</p>
                    <p class="text-sm text-gray-600">Django 5.2.8 + MySQL 8.0</p>
                </div>
            </div>
        </div>

        <!-- Pruebas de API -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6" x-data="apiTester()">
            <h2 class="text-xl font-semibold mb-4">üîå Pruebas de API</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <button @click="testHealth()" 
                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg">
                    Health Check
                </button>
                <button @click="testAPI()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                    API v1
                </button>
                <button @click="testPOS()" 
                        class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg">
                    API POS
                </button>
                <button @click="testDocs()" 
                        class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg">
                    API Docs
                </button>
            </div>

            <!-- Resultados de las pruebas -->
            <div id="test-results" class="space-y-2">
                <template x-for="result in results" :key="result.id">
                    <div :class="{
                        'bg-green-100 border-green-400 text-green-700': result.success,
                        'bg-red-100 border-red-400 text-red-700': !result.success
                    }" class="border px-4 py-3 rounded relative">
                        <strong x-text="result.title"></strong>
                        <span x-text="result.message" class="block sm:inline"></span>
                        <span x-show="result.data" x-text="result.data" class="block text-xs mt-1 opacity-75"></span>
                    </div>
                </template>
            </div>
        </div>

        <!-- Demo de Funcionalidades -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4">üéØ Demo de Funcionalidades</h2>
            
            <!-- Demo con HTMX -->
            <div class="border rounded-lg p-4 mb-4">
                <h3 class="font-semibold mb-2">Demo HTMX - Carga de Datos</h3>
                <button hx-get="/api/v1/" 
                        hx-target="#htmx-result" 
                        hx-swap="innerHTML"
                        class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg mb-2">
                    Cargar Info API
                </button>
                <div id="htmx-result" class="p-2 bg-gray-50 rounded border min-h-[40px]">
                    Resultado HTMX aparecer√° aqu√≠...
                </div>
            </div>

            <!-- Demo con Alpine.js + Fetch API -->
            <div class="border rounded-lg p-4" x-data="demoApp()">
                <h3 class="font-semibold mb-2">Demo Alpine.js - Datos Din√°micos</h3>
                <div class="mb-4">
                    <button @click="loadData('/api/v1/')" 
                            class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-2 rounded-lg mr-2">
                        API v1
                    </button>
                    <button @click="loadData('/api/pos/')" 
                            class="bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg">
                        API POS
                    </button>
                </div>
                <div class="bg-gray-50 rounded border p-3">
                    <div x-show="loading" class="text-blue-600">üîÑ Cargando...</div>
                    <div x-show="error" x-text="error" class="text-red-600"></div>
                    <div x-show="data && !loading" class="space-y-2">
                        <div class="text-sm text-gray-600">Respuesta de la API:</div>
                        <pre x-text="JSON.stringify(data, null, 2)" class="text-xs bg-gray-100 p-2 rounded overflow-auto max-h-40"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Informaci√≥n T√©cnica -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-xl font-semibold mb-4">‚öôÔ∏è Configuraci√≥n T√©cnica</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Frontend</h3>
                    <ul class="bg-gray-50 rounded p-4 text-sm space-y-1">
                        <li>‚úÖ Vite 5.x para bundling</li>
                        <li>‚úÖ TypeScript para tipado</li>
                        <li>‚úÖ Alpine.js para reactividad</li>
                        <li>‚úÖ HTMX para interactividad</li>
                        <li>‚úÖ Tailwind CSS para estilos</li>
                        <li>‚úÖ Proxy configurado: /api ‚Üí :8000</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-gray-800 mb-2">Backend</h3>
                    <ul class="bg-gray-50 rounded p-4 text-sm space-y-1">
                        <li>‚úÖ Django 5.2.8</li>
                        <li>‚úÖ MySQL 8.0 conectado</li>
                        <li>‚úÖ Django REST Framework</li>
                        <li>‚úÖ CORS configurado</li>
                        <li>‚úÖ JWT Authentication</li>
                        <li>‚úÖ API Documentation (Swagger)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Componente Alpine.js para pruebas de API
        function apiTester() {
            return {
                results: [],
                
                addResult(title, message, success, data = null) {
                    this.results.unshift({
                        id: Date.now(),
                        title,
                        message,
                        success,
                        data: data ? JSON.stringify(data).substring(0, 200) + '...' : null
                    });
                    // Mantener solo los √∫ltimos 8 resultados
                    if (this.results.length > 8) {
                        this.results = this.results.slice(0, 8);
                    }
                },

                async testHealth() {
                    try {
                        const response = await fetch('/health/');
                        const data = await response.json();
                        this.addResult('Health Check', `‚úÖ Status: ${response.status}`, true, data);
                    } catch (error) {
                        this.addResult('Health Check', `‚ùå Error: ${error.message}`, false);
                    }
                },

                async testAPI() {
                    try {
                        const response = await fetch('/api/v1/');
                        const data = await response.json();
                        this.addResult('API v1', `‚úÖ Status: ${response.status}`, true, data);
                    } catch (error) {
                        this.addResult('API v1', `‚ùå Error: ${error.message}`, false);
                    }
                },

                async testPOS() {
                    try {
                        const response = await fetch('/api/pos/');
                        const data = await response.json();
                        this.addResult('API POS', `‚úÖ Status: ${response.status}`, true, data);
                    } catch (error) {
                        this.addResult('API POS', `‚ùå Error: ${error.message}`, false);
                    }
                },

                async testDocs() {
                    try {
                        const response = await fetch('/api/docs/');
                        this.addResult('API Docs', `‚úÖ Status: ${response.status} - Swagger disponible`, true);
                    } catch (error) {
                        this.addResult('API Docs', `‚ùå Error: ${error.message}`, false);
                    }
                }
            }
        }

        // Componente Alpine.js para demo de funcionalidades
        function demoApp() {
            return {
                data: null,
                loading: false,
                error: null,

                async loadData(endpoint) {
                    this.loading = true;
                    this.error = null;
                    this.data = null;

                    try {
                        const response = await fetch(endpoint);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        this.data = await response.json();
                    } catch (error) {
                        this.error = `Error: ${error.message}`;
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }

        // Verificaci√≥n inicial del backend
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/health/');
                if (response.ok) {
                    document.getElementById('backend-url').textContent = '‚úÖ http://localhost:8000';
                    document.getElementById('backend-status').className = 'p-4 bg-green-100 rounded-lg';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('backend-url').textContent = '‚ùå No conectado';
                document.getElementById('backend-status').className = 'p-4 bg-red-100 rounded-lg';
            }
        });
    </script>
</body>
</html>