{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}POS - Cantina Tita{% endblock %}</title>
    
    <!-- DaisyUI + Tailwind -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        {% block base_styles %}
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        /* Header estándar POS */
        .pos-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .pos-header.orange {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
        }
        
        .pos-header.purple {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Card style consistente */
        .card-pos {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        
        /* Botones touch-friendly */
        .btn-pos {
            min-height: 60px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.2s ease;
        }
        
        .btn-pos:active {
            transform: scale(0.95);
        }
        
        /* Animaciones */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Grid de productos consistente */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .product-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem 1rem;
            border: 2px solid #e5e7eb;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }
        
        .product-card:active {
            transform: translateY(0) scale(0.98);
        }
        
        .product-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        
        .product-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }
        
        .product-price {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 700;
            display: inline-block;
            font-size: 1.1rem;
        }
        {% endblock %}
        
        {% block extra_styles %}{% endblock %}
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    
    <!-- Header POS -->
    <div class="pos-header {% block header_color %}purple{% endblock %} text-white py-4 px-6 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <a href="{% url 'pos:venta' %}" class="text-3xl font-bold flex items-center gap-2 hover:opacity-80 transition">
                    <i class="fas fa-shopping-cart"></i>
                    Cantina Tita POS
                </a>
            </div>
            
            <div class="flex items-center gap-4">
                <!-- Hora actual -->
                <div class="text-sm" x-data="{ time: new Date().toLocaleTimeString('es-PY') }" 
                     x-init="setInterval(() => time = new Date().toLocaleTimeString('es-PY'), 1000)">
                    <i class="far fa-clock"></i>
                    <span x-text="time"></span>
                </div>
                
                <!-- Usuario -->
                <div class="dropdown dropdown-end">
                    <label tabindex="0" class="btn btn-ghost flex items-center gap-2">
                        <i class="fas fa-user-circle text-2xl"></i>
                        <span class="hidden md:inline">{{ request.user.username|upper }}</span>
                    </label>
                    <ul tabindex="0" class="dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52 mt-3">
                        <li class="menu-title text-gray-700">
                            <span>{{ request.user.username }}</span>
                        </li>
                        <li><a href="{% url 'dashboard_unificado' %}"><i class="fas fa-chart-line"></i> Dashboard</a></li>
                        <li><a href="{% url 'pos:venta' %}"><i class="fas fa-cash-register"></i> POS Ventas</a></li>
                        <li><a href="{% url 'pos:almuerzo_venta' %}"><i class="fas fa-utensils"></i> POS Almuerzo</a></li>
                        <li><a href="{% url 'pos:cargar_saldo_tarjeta' %}"><i class="fas fa-wallet"></i> Cargar Saldo</a></li>
                        <li class="border-t mt-2 pt-2">
                            <form method="post" action="{% url 'logout' %}">
                                {% csrf_token %}
                                <button type="submit" class="w-full text-left text-red-600">
                                    <i class="fas fa-sign-out-alt"></i> Cerrar Sesión
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Contenido principal -->
    <div class="container mx-auto px-4 py-6">
        {% block content %}{% endblock %}
    </div>
    
    <!-- Alpine.js components -->
    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('posApp', () => ({
                cart: [],
                total: 0,
                
                addToCart(product) {
                    const existing = this.cart.find(item => item.id === product.id);
                    if (existing) {
                        existing.quantity++;
                    } else {
                        this.cart.push({ ...product, quantity: 1 });
                    }
                    this.calculateTotal();
                    this.playSound('add');
                },
                
                removeFromCart(index) {
                    this.cart.splice(index, 1);
                    this.calculateTotal();
                },
                
                increaseQuantity(index) {
                    this.cart[index].quantity++;
                    this.calculateTotal();
                },
                
                decreaseQuantity(index) {
                    if (this.cart[index].quantity > 1) {
                        this.cart[index].quantity--;
                        this.calculateTotal();
                    } else {
                        this.removeFromCart(index);
                    }
                },
                
                calculateTotal() {
                    this.total = this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                },
                
                clearCart() {
                    this.cart = [];
                    this.total = 0;
                },
                
                playSound(type) {
                    // Feedback sonoro opcional
                    const audio = new Audio(`/static/sounds/${type}.mp3`);
                    audio.volume = 0.3;
                    audio.play().catch(() => {});
                },
                
                formatCurrency(amount) {
                    return new Intl.NumberFormat('es-PY', {
                        style: 'decimal',
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 0
                    }).format(amount);
                }
            }));
        });
    </script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>
