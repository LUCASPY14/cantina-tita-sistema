{% extends "base.html" %}
{% load humanize %}

{% block title %}Sistema de Comisiones{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold text-neutral">üí≥ Sistema de Comisiones</h1>
            <p class="text-sm text-neutral/70 mt-1">Tarjetas de Cr√©dito/D√©bito y Giros Tigo (POS Bancard)</p>
        </div>
        <div class="flex gap-2">
            <a href="{% url 'pos:configurar_tarifas' %}" class="btn btn-primary">‚öôÔ∏è Configurar Tarifas</a>
            <a href="{% url 'pos:reporte_comisiones' %}" class="btn btn-info">üìä Reporte</a>
        </div>
    </div>

    <!-- Estad√≠sticas del Mes -->
    <div class="stats stats-vertical lg:stats-horizontal shadow w-full mb-6">
        <div class="stat">
            <div class="stat-figure text-primary">üí∞</div>
            <div class="stat-title">Total Comisiones Mes</div>
            <div class="stat-value text-primary text-2xl">Gs. {{ total_comision_mes|floatformat:0|intcomma }}</div>
        </div>
        <div class="stat">
            <div class="stat-figure text-success">üíµ</div>
            <div class="stat-title">Total Transacciones</div>
            <div class="stat-value text-success text-2xl">Gs. {{ total_transacciones_mes|floatformat:0|intcomma }}</div>
        </div>
        <div class="stat">
            <div class="stat-figure text-info">üìä</div>
            <div class="stat-title">Porcentaje Promedio</div>
            <div class="stat-value text-info">
                {% if total_transacciones_mes > 0 %}
                {{ total_comision_mes|floatformat:0 }} / {{ total_transacciones_mes|floatformat:0 }} * 100 %}%
                {% else %}
                0%
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Tarifas Configuradas -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">‚öôÔ∏è Tarifas Configuradas</h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra w-full">
                    <thead>
                        <tr class="bg-neutral text-neutral-content">
                            <th>Medio de Pago</th>
                            <th>Porcentaje</th>
                            <th>Monto Fijo</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tarifa in tarifas %}
                        <tr>
                            <td class="font-bold">{{ tarifa.id_medio_pago.descripcion }}</td>
                            <td class="font-mono">{{ tarifa.porcentaje }}%</td>
                            <td class="font-mono">Gs. {{ tarifa.monto_fijo|floatformat:0|intcomma }}</td>
                            <td>
                                {% if tarifa.activo %}
                                <span class="badge badge-success">Activa</span>
                                {% else %}
                                <span class="badge badge-error">Inactiva</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="4" class="text-center text-neutral/50">No hay tarifas configuradas. <a href="{% url 'pos:configurar_tarifas' %}" class="link">Configurar ahora</a></td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Comisiones por Medio de Pago -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">üí≥ Comisiones del Mes por Medio</h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra w-full">
                    <thead>
                        <tr class="bg-neutral text-neutral-content">
                            <th>Medio de Pago</th>
                            <th>Cantidad</th>
                            <th>Total Comisi√≥n</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in comisiones_por_medio %}
                        <tr>
                            <td class="font-bold">{{ item.medio.descripcion }}</td>
                            <td>{{ item.cantidad }}</td>
                            <td class="font-mono text-lg text-primary">Gs. {{ item.total_comision|floatformat:0|intcomma }}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="3" class="text-center text-neutral/50">No hay comisiones registradas este mes</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
