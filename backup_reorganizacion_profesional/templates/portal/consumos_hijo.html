{% extends "portal/base_portal.html" %}

{% block title %}Consumos de {{ hijo.nombre_completo }} - Portal de Padres{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
            <a href="{% url 'clientes:portal_dashboard' %}" class="btn btn-ghost btn-sm mr-4">
                ‚Üê Volver
            </a>
            <h1 class="text-3xl font-bold text-gray-800">üìä Consumos de {{ hijo.nombre_completo }}</h1>
        </div>
    </div>
    
    <!-- Filtros -->
    <div class="card bg-base-100 shadow-xl mb-6">
        <div class="card-body">
            <h2 class="card-title">Filtrar por fecha</h2>
            <form method="GET" class="flex flex-wrap gap-4">
                {% if active_tab %}
                <input type="hidden" name="tab" value="{{ active_tab }}">
                {% endif %}
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Desde</span>
                    </label>
                    <input type="date" name="desde" value="{{ fecha_desde }}" class="input input-bordered">
                </div>
                <div class="form-control">
                    <label class="label">
                        <span class="label-text">Hasta</span>
                    </label>
                    <input type="date" name="hasta" value="{{ fecha_hasta }}" class="input input-bordered">
                </div>
                <div class="form-control mt-8">
                    <button type="submit" class="btn btn-primary">Filtrar</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Tabs para Ventas y Almuerzos -->
    <div class="tabs tabs-boxed mb-4">
        <a href="?tab=cantina{% if fecha_desde %}&desde={{ fecha_desde }}{% endif %}{% if fecha_hasta %}&hasta={{ fecha_hasta }}{% endif %}" 
           class="tab {% if active_tab == 'cantina' %}tab-active{% endif %}">
            Cantina
        </a>
        <a href="?tab=almuerzos{% if fecha_desde %}&desde={{ fecha_desde }}{% endif %}{% if fecha_hasta %}&hasta={{ fecha_hasta }}{% endif %}" 
           class="tab {% if active_tab == 'almuerzos' %}tab-active{% endif %}">
            Almuerzos
        </a>
    </div>
    
    <!-- Contenido Tab Ventas -->
    <div id="content-ventas" class="{% if active_tab != 'cantina' %} hidden{% endif %}">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">üõí Consumos en Cantina</h2>
                
                {% if ventas %}
                <div class="overflow-x-auto">
                    <table class="table table-zebra">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Monto</th>
                                <th>Tipo Pago</th>
                                <th>Estado</th>
                                <th>Cajero</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for venta in ventas %}
                            <tr>
                                <td>{{ venta.fecha|date:"d/m/Y H:i" }}</td>
                                <td class="font-bold">‚Ç≤ {{ venta.monto_total|floatformat:0 }}</td>
                                <td>
                                    {% if venta.id_tipo_pago %}
                                        {{ venta.id_tipo_pago.descripcion }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if venta.estado == 'completado' %}
                                        <span class="badge badge-success">Completado</span>
                                    {% elif venta.estado == 'pendiente' %}
                                        <span class="badge badge-warning">Pendiente</span>
                                    {% else %}
                                        <span class="badge badge-ghost">{{ venta.estado }}</span>
                                    {% endif %}
                                </td>
                                <td class="text-sm">
                                    {% if venta.id_empleado_cajero %}
                                        {{ venta.id_empleado_cajero.nombre_completo }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Paginaci√≥n Ventas -->
                {% if ventas_page.has_other_pages %}
                <div class="flex justify-center mt-6">
                    <div class="btn-group">
                        {% if ventas_page.has_previous %}
                        <a href="?page_ventas={{ ventas_page.previous_page_number }}{% if request.GET.desde %}&desde={{ request.GET.desde }}{% endif %}{% if request.GET.hasta %}&hasta={{ request.GET.hasta }}{% endif %}" class="btn btn-sm">¬´</a>
                        {% endif %}
                        <button class="btn btn-sm btn-active">P√°gina {{ ventas_page.number }}</button>
                        {% if ventas_page.has_next %}
                        <a href="?page_ventas={{ ventas_page.next_page_number }}{% if request.GET.desde %}&desde={{ request.GET.desde }}{% endif %}{% if request.GET.hasta %}&hasta={{ request.GET.hasta }}{% endif %}" class="btn btn-sm">¬ª</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                {% else %}
                <div class="alert alert-info">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current flex-shrink-0 w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>No hay consumos en cantina en este per√≠odo.</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Contenido Tab Almuerzos -->
    <div id="content-almuerzos" class="{% if active_tab != 'almuerzos' %} hidden{% endif %}">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h2 class="card-title">üçΩÔ∏è Consumo de Almuerzos</h2>
                
                {% if almuerzos %}
                <div class="overflow-x-auto">
                    <table class="table table-zebra">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo Almuerzo</th>
                                <th>Costo</th>
                                <th>Hora Registro</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for almuerzo in almuerzos %}
                            <tr>
                                <td>{{ almuerzo.fecha_consumo|date:"d/m/Y" }}</td>
                                <td>
                                    {% if almuerzo.id_tipo_almuerzo %}
                                        {{ almuerzo.id_tipo_almuerzo.nombre }}
                                    {% else %}
                                        Almuerzo
                                    {% endif %}
                                </td>
                                <td class="font-bold">‚Ç≤ {{ almuerzo.costo_almuerzo|floatformat:0 }}</td>
                                <td class="text-sm">{{ almuerzo.hora_registro|time:"H:i" }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <!-- Paginaci√≥n Almuerzos -->
                {% if almuerzos_page.has_other_pages %}
                <div class="flex justify-center mt-6">
                    <div class="btn-group">
                        {% if almuerzos_page.has_previous %}
                        <a href="?page_almuerzos={{ almuerzos_page.previous_page_number }}{% if request.GET.desde %}&desde={{ request.GET.desde }}{% endif %}{% if request.GET.hasta %}&hasta={{ request.GET.hasta }}{% endif %}" class="btn btn-sm">¬´</a>
                        {% endif %}
                        <button class="btn btn-sm btn-active">P√°gina {{ almuerzos_page.number }}</button>
                        {% if almuerzos_page.has_next %}
                        <a href="?page_almuerzos={{ almuerzos_page.next_page_number }}{% if request.GET.desde %}&desde={{ request.GET.desde }}{% endif %}{% if request.GET.hasta %}&hasta={{ request.GET.hasta }}{% endif %}" class="btn btn-sm">¬ª</a>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                {% else %}
                <div class="alert alert-info">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current flex-shrink-0 w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>No hay almuerzos registrados en este per√≠odo.</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}