{% extends "base.html" %}
{% load humanize %}

{% block title %}Sistema de Compras{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold text-neutral">üõí Sistema de Compras</h1>
            <p class="text-sm text-neutral/70 mt-1">Gesti√≥n de compras y proveedores</p>
        </div>
        <a href="{% url 'pos:nueva_compra' %}" class="btn btn-primary">‚ûï Nueva Compra</a>
    </div>

    <!-- Estad√≠sticas -->
    <div class="stats stats-vertical lg:stats-horizontal shadow w-full mb-6">
        <div class="stat">
            <div class="stat-figure text-primary">üõí</div>
            <div class="stat-title">Compras del Mes</div>
            <div class="stat-value text-primary">{{ cantidad_mes }}</div>
            <div class="stat-desc">Total: Gs. {{ total_mes|floatformat:0|intcomma }}</div>
        </div>
        <div class="stat">
            <div class="stat-figure text-warning">‚è≥</div>
            <div class="stat-title">Pendientes</div>
            <div class="stat-value text-warning">{{ compras_pendientes }}</div>
            <div class="stat-desc">Sin recibir</div>
        </div>
        <div class="stat">
            <div class="stat-figure text-error">üí∞</div>
            <div class="stat-title">Deuda Total</div>
            <div class="stat-value text-error text-2xl">Gs. {{ deuda_total|floatformat:0|intcomma }}</div>
            <div class="stat-desc"><a href="{% url 'pos:deuda_proveedores' %}" class="link">Ver detalle</a></div>
        </div>
    </div>

    <!-- √öltimas Compras -->
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
            <h2 class="card-title text-2xl mb-4">üìã √öltimas Compras</h2>
            <div class="overflow-x-auto">
                <table class="table table-zebra w-full">
                    <thead>
                        <tr class="bg-neutral text-neutral-content">
                            <th>ID</th>
                            <th>Proveedor</th>
                            <th>Fecha</th>
                            <th>Factura</th>
                            <th>Total</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for compra in compras_recientes %}
                        <tr>
                            <td class="font-mono">#{{ compra.id_compra }}</td>
                            <td class="font-bold">{{ compra.id_proveedor.razon_social }}</td>
                            <td>{{ compra.fecha_compra|date:"d/m/Y" }}</td>
                            <td>{{ compra.nro_factura|default:"-" }}</td>
                            <td class="font-mono">Gs. {{ compra.total|floatformat:0|intcomma }}</td>
                            <td>
                                {% if compra.estado == 'Pendiente' %}
                                <span class="badge badge-warning">Pendiente</span>
                                {% else %}
                                <span class="badge badge-success">Recibida</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if compra.estado == 'Pendiente' %}
                                <a href="{% url 'pos:recepcion_mercaderia' compra.id_compra %}" class="btn btn-sm btn-info">üì¶ Recibir</a>
                                {% else %}
                                <span class="text-neutral/50">‚úì</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="7" class="text-center text-neutral/50">No hay compras registradas</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
